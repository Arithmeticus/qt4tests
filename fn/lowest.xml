<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns="http://www.w3.org/2010/09/qt-fots-catalog" name="fn-lowest">
   <description>Tests for the fn:lowest function (4.0 proposal)</description>
   
   <dependency type="spec" value="XP40+ XQ40+"/>
    
   <test-case name="lowest-001">
      <description>test lowest() - Saxon 9.2 version using higher-order functions</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <test>
         lowest(doc('highest/highest-001.xml')/*/*, function($item as element()){xs:decimal($item)})
      </test>
      <result>
         <all-of>
            <assert>count($result) = 1</assert>
            <assert>$result[1][@id="6"]='-56.0'</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="lowest-002">
      <description>test lowest() on an empty sequence - Saxon 9.2 version using higher-order functions</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <test>
         lowest(doc('highest/highest-001.xml')/*/*[@non-existent], function($item as element()){xs:decimal($item)})
      </test>
      <result>
         <assert-empty/>
      </result>
   </test-case>
   
   <test-case name="lowest-003">
      <description>test lowest() using collations - Saxon 9.2 version using higher-order functions</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <environment>
         <collation default="true" uri="http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"/>
      </environment>
      <test>
         lowest(doc('highest/highest-003.xml')/*/*, function($item as element()){xs:string($item)})
      </test>
      <result>
         <all-of>
            <assert>count($result) = 1</assert>
            <assert>$result[1][@id="4"]='CAT'</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="lowest-004">
      <description>test lowest() with a default collation</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <environment>
         <collation default="true" uri="http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"/>
      </environment>
      <test>
         lowest(doc('highest/highest-003.xml')/*/*, string#1)        
      </test>
      <result>
         <all-of>
            <!-- TODO: test not yet working. MHK 2020-06-29 -->
            <assert>$result[1][@id="5"]='katy'</assert>
            <assert>$result[2][@id="7"]='Katy'</assert>
            <assert>$result[3][@id="8"]='KATY'</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="lowest-005">
      <description>test lowest() : second argument is a system function</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <test>
         lowest(doc('highest/highest-005.xml')/*/*, round#1)   
      </test>
      <result>
         <all-of>
            <assert>$result[1][@id="6"]='-56.0'</assert>
         </all-of>
      </result>
   </test-case> 
   
   <test-case name="lowest-901">
      <description>test lowest() second argument is a call on a function with the wrong signature</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <test>
         lowest(doc('highest/highest-005.xml')/*/*, round#2)   
      </test>
      <result>
         <error code="XPTY0004"/>
      </result>
   </test-case>
   
   <test-case name="lowest-902">
      <description>test lowest() implicit string-to-double conversion fails</description>
      <created by="Michael Kay" on="2014-04-13"/>
      <environment>
         <collation default="true" uri="http://www.w3.org/2005/xpath-functions/collation/html-ascii-case-insensitive"/>
      </environment>
      <test>
         lowest(doc('highest/highest-003.xml')/*/*)        
      </test>
      <result>
         <error code="FORG0001"/>
      </result>
   </test-case>
</test-set>
